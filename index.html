<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vino</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Roboto:wght@400;500&family=Great+Vibes&display=swap" rel="stylesheet">
    <style>
        :root {
            --brand-red: #8B1A1A; /* Bordô mais profundo */
            --brand-dark-red: #6e1414;
            --brand-bg: #F9F5F0;
            --brand-text: #3D352E;
        }
        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--brand-bg);
            color: var(--brand-text);
        }
        .title-font {
            font-family: 'Playfair Display', serif;
        }
        .handwritten-font {
            font-family: 'Great Vibes', cursive;
        }
        .btn-primary {
            background-color: var(--brand-red);
            color: white;
            transition: background-color 0.3s ease;
        }
        .btn-primary:hover:not(:disabled) {
            background-color: var(--brand-dark-red);
        }
        .btn-primary:disabled {
            background-color: var(--brand-red);
            opacity: 0.6;
            cursor: not-allowed;
        }
        .btn-secondary {
            background-color: transparent;
            color: var(--brand-red);
            border: 1px solid var(--brand-red);
            transition: all 0.3s ease;
        }
        .btn-secondary:hover:not(:disabled) {
            background-color: rgba(139, 26, 26, 0.05);
        }
        .view { display: none; }
        .view.active { display: block; }
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(139, 26, 26, 0.1);
            border-top: 4px solid var(--brand-red);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        select, textarea, input {
            background-color: #FFFFFF;
            color: var(--brand-text);
            border: 1px solid #D1C7BC;
        }
        select:focus, textarea:focus, input:focus {
            border-color: var(--brand-red);
            box-shadow: 0 0 0 1px var(--brand-red);
            outline: none;
        }
        .menu-icon {
            color: var(--brand-red);
            opacity: 0.7;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <div class="w-full max-w-md mx-auto bg-white rounded-2xl shadow-xl overflow-hidden relative">
         <!-- Elemento decorativo -->
        <div class="absolute bottom-4 right-4 text-[--brand-red] opacity-10 pointer-events-none">
            <svg xmlns="http://www.w3.org/2000/svg" width="120" height="120" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0.5" stroke-linecap="round" stroke-linejoin="round">
                <!-- Contorno do Copo de Vinho -->
                <path d="M8 22h8"></path>
                <path d="M12 14v8"></path>
                <path d="M18 5c0 4.4-4 8-6 8s-6-3.6-6-8c0-3.9 2.7-7 6-7s6 3.1 6 7z"></path>

                <!-- Cacho de Uvas dentro do copo -->
                <circle cx="12" cy="7" r="1"></circle>
                <circle cx="10.5" cy="8.5" r="1"></circle>
                <circle cx="13.5" cy="8.5" r="1"></circle>
                <circle cx="9.5" cy="10.5" r="1"></circle>
                <circle cx="12" cy="10.5" r="1"></circle>
                <circle cx="14.5" cy="10.5" r="1"></circle>
                <circle cx="10.5" cy="12.5" r="1"></circle>
                <circle cx="13.5" cy="12.5" r="1"></circle>
            </svg>
        </div>

        <!-- Cabeçalho -->
        <header class="p-5 flex justify-between items-center bg-[--brand-red] text-white">
            <h1 class="handwritten-font text-5xl">Vino</h1>
            <button id="lang-toggle" class="font-bold text-sm px-3 py-1 rounded-full transition border border-white/50 hover:bg-white/10">PT</button>
        </header>

        <main class="p-6 md:p-8">
            <!-- Vista de Início -->
            <div id="home-view" class="view active">
                <div class="text-center">
                    <h2 class="text-2xl font-bold" data-lang-key="home_welcome">Beba vinhos, não rótulos.</h2>
                    <p class="mt-2 text-gray-600" data-lang-key="home_subtitle">O seu assistente para descobrir o melhor de Portugal.</p>
                </div>
                <div class="mt-8 space-y-4">
                    <button class="w-full text-left p-4 border rounded-lg hover:bg-gray-50 transition" data-view="recommender-view">
                        <div class="flex items-center gap-4">
                            <div class="menu-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8 22h8"/><path d="M12 14v8"/><path d="M18 5c0 4.4-4 8-6 8s-6-3.6-6-8c0-3.9 2.7-7 6-7s6 3.1 6 7z"/></svg>
                            </div>
                            <div>
                                <h3 class="font-bold text-lg" data-lang-key="menu_recommend_title">Recomendar Vinho</h3>
                                <p class="text-sm text-gray-500" data-lang-key="menu_recommend_desc">Encontre o vinho perfeito com base nas suas preferências.</p>
                            </div>
                        </div>
                    </button>
                    <button class="w-full text-left p-4 border rounded-lg hover:bg-gray-50 transition" data-view="dish-view">
                        <div class="flex items-center gap-4">
                             <div class="menu-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <circle cx="12" cy="12" r="6"></circle>
                                </svg>
                            </div>
                            <div>
                                <h3 class="font-bold text-lg" data-lang-key="menu_dish_title">Vinho para um Prato</h3>
                                <p class="text-sm text-gray-500" data-lang-key="menu_dish_desc">Diga-nos o que vai cozinhar e nós sugerimos o vinho.</p>
                            </div>
                        </div>
                    </button>
                    <button class="w-full text-left p-4 border rounded-lg hover:bg-gray-50 transition" data-view="gift-view">
                         <div class="flex items-center gap-4">
                             <div class="menu-icon">
                               <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 12v10H4V12"/><path d="M2 7h20v5H2z"/><path d="M12 22V7"/><path d="M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z"/><path d="M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z"/></svg>
                            </div>
                            <div>
                                <h3 class="font-bold text-lg" data-lang-key="menu_gift_title">Oferecer um Vinho</h3>
                                <p class="text-sm text-gray-500" data-lang-key="menu_gift_desc">Encontre a prenda ideal para qualquer ocasião.</p>
                            </div>
                        </div>
                    </button>
                    <button class="w-full text-left p-4 border rounded-lg hover:bg-gray-50 transition" data-view="curiosities-view">
                         <div class="flex items-center gap-4">
                             <div class="menu-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
                            </div>
                            <div>
                                <h3 class="font-bold text-lg" data-lang-key="menu_curiosity_title">Curiosidades</h3>
                                <p class="text-sm text-gray-500" data-lang-key="menu_curiosity_desc">Pergunte algo sobre vinhos ou veja a curiosidade do dia.</p>
                            </div>
                        </div>
                    </button>
                </div>
            </div>

            <!-- Vista: Recomendar Vinho -->
            <div id="recommender-view" class="view">
                <h2 class="text-2xl font-bold text-center text-[--brand-red]" data-lang-key="menu_recommend_title">Recomendar Vinho</h2>
                <div id="recommender-form-container">
                    <div class="space-y-4 mt-6">
                        <div>
                            <label class="block text-sm font-medium mb-1" data-lang-key="recommender_occasion_label">Qual a ocasião?</label>
                            <select id="recommender-occasion" class="w-full p-2 rounded-md"></select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1" data-lang-key="recommender_type_label">Que tipo de vinho prefere?</label>
                            <select id="recommender-type" class="w-full p-2 rounded-md">
                                <!-- Opções JS -->
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1" data-lang-key="recommender_budget_label">Qual o seu orçamento?</label>
                            <select id="recommender-budget" class="w-full p-2 rounded-md">
                                <!-- Opções JS -->
                            </select>
                        </div>
                    </div>
                    <div class="mt-8 text-center">
                        <button id="recommender-btn" class="btn-primary font-bold py-2 px-6 rounded-lg w-full flex items-center justify-center gap-2" data-lang-key="btn_search">
                            <span>Pesquisar</span>
                        </button>
                    </div>
                </div>
                <div id="recommender-result" class="mt-6"></div>
                <div class="mt-6 text-center">
                    <button class="btn-secondary w-full py-2 rounded-md home-btn" data-lang-key="btn_homepage">Voltar ao Início</button>
                </div>
            </div>

            <!-- Vista: Vinho para Prato -->
            <div id="dish-view" class="view">
                <h2 class="text-2xl font-bold text-center text-[--brand-red]" data-lang-key="menu_dish_title">Vinho para um Prato</h2>
                <div id="dish-form-container">
                    <div class="space-y-4 mt-6">
                        <div>
                            <label class="block text-sm font-medium mb-1" data-lang-key="dish_label">O que vai cozinhar?</label>
                            <textarea id="dish-input" class="w-full p-2 rounded-md" rows="3" data-lang-key="dish_placeholder" placeholder="Ex: Bacalhau com natas, bife da vazia grelhado..."></textarea>
                        </div>
                    </div>
                    <div class="mt-8 text-center">
                         <button id="dish-btn" class="btn-primary font-bold py-2 px-6 rounded-lg w-full flex items-center justify-center gap-2" data-lang-key="btn_suggest_wine">
                            <span>Sugerir Vinho</span>
                        </button>
                    </div>
                </div>
                <div id="dish-result" class="mt-6"></div>
                <div class="mt-6 text-center">
                    <button class="btn-secondary w-full py-2 rounded-md home-btn" data-lang-key="btn_homepage">Voltar ao Início</button>
                </div>
            </div>

            <!-- Vista: Oferecer Vinho -->
            <div id="gift-view" class="view">
                <h2 class="text-2xl font-bold text-center text-[--brand-red]" data-lang-key="menu_gift_title">Oferecer um Vinho</h2>
                <div id="gift-form-container">
                     <div class="space-y-4 mt-6">
                        <div>
                            <label class="block text-sm font-medium mb-1" data-lang-key="gift_label">Descreva a pessoa e a ocasião:</label>
                            <textarea id="gift-input" class="w-full p-2 rounded-md" rows="4" data-lang-key="gift_placeholder" placeholder="Ex: É para o aniversário do meu pai, que adora tintos encorpados do Douro..."></textarea>
                        </div>
                    </div>
                    <div class="mt-8 text-center">
                         <button id="gift-btn" class="btn-primary font-bold py-2 px-6 rounded-lg w-full flex items-center justify-center gap-2" data-lang-key="btn_suggest_gift">
                            <span>Sugerir Oferta</span>
                        </button>
                    </div>
                </div>
                <div id="gift-result" class="mt-6"></div>
                <div class="mt-6 text-center">
                    <button class="btn-secondary w-full py-2 rounded-md home-btn" data-lang-key="btn_homepage">Voltar ao Início</button>
                </div>
            </div>
            
            <!-- Vista: Curiosidades -->
            <div id="curiosities-view" class="view">
                <h2 class="text-2xl font-bold text-center text-[--brand-red]" data-lang-key="menu_curiosity_title">Curiosidades</h2>
                <div id="curiosities-form-container">
                    <div class="space-y-4 mt-6">
                        <div>
                            <label class="block text-sm font-medium mb-1" data-lang-key="curiosity_label">Qual a sua dúvida sobre vinhos?</label>
                            <textarea id="curiosity-input" class="w-full p-2 rounded-md" rows="3" data-lang-key="curiosity_placeholder" placeholder="Ex: Qual a diferença entre Touriga Nacional e Tinta Roriz?"></textarea>
                        </div>
                    </div>
                    <div class="mt-6 text-center space-y-3">
                         <button id="curiosity-ask-btn" class="btn-primary font-bold py-2 px-6 rounded-lg w-full flex items-center justify-center gap-2" data-lang-key="btn_ask">
                            <span>Perguntar</span>
                        </button>
                         <button id="curiosity-day-btn" class="btn-secondary font-bold py-2 px-6 rounded-lg w-full flex items-center justify-center gap-2" data-lang-key="btn_curiosity_day">
                            <span>Curiosidade do Dia</span>
                        </button>
                    </div>
                </div>
                <div id="curiosities-result" class="mt-6"></div>
                <div class="mt-6 text-center">
                    <button class="btn-secondary w-full py-2 rounded-md home-btn" data-lang-key="btn_homepage">Voltar ao Início</button>
                </div>
            </div>

        </main>
    </div>

<script>
    document.addEventListener('DOMContentLoaded', () => {

        // --- Estado da Aplicação ---
        let currentLang = 'pt';
        let wines = [];
        let lastFilteredWines = [];
        let lastSuggestionContext = {};
        
        // --- Elementos DOM ---
        const langToggle = document.getElementById('lang-toggle');
        const allLangElements = document.querySelectorAll('[data-lang-key]');
        const menuButtons = document.querySelectorAll('[data-view]');
        const views = document.querySelectorAll('.view');

        // --- Base de Dados de Vinhos ---
        const wineDatabase = [
          { "id": 1, "name": "Vinha Grande Tinto 2021", "type": "Tinto", "region": "Douro", "price": 12.99, "description_pt": "Um clássico do Douro, robusto e com notas de frutos vermelhos maduros.", "description_en": "A classic from Douro, robust with notes of ripe red fruits." },
          { "id": 2, "name": "Muros Antigos Alvarinho 2022", "type": "Branco", "region": "Vinho Verde", "price": 9.50, "description_pt": "Vibrante e aromático, com notas cítricas e tropicais, perfeito para mariscos.", "description_en": "Vibrant and aromatic, with citrus and tropical notes, perfect for seafood." },
          { "id": 3, "name": "Mateus Rosé Original", "type": "Rosé", "region": "Vinho de Mesa", "price": 5.99, "description_pt": "Leve e ligeiramente efervescente, com aromas a frutos vermelhos frescos. Ótimo como aperitivo.", "description_en": "Light and slightly sparkling, with aromas of fresh red fruits. Great as an aperitif." },
          { "id": 4, "name": "Raposeira Super Reserva Bruto", "type": "Espumante", "region": "Távora-Varosa", "price": 7.80, "description_pt": "Método clássico com bolha fina e persistente, ideal para celebrações.", "description_en": "Classic method with fine and persistent bubbles, ideal for celebrations." },
          { "id": 5, "name": "Cartuxa Colheita Tinto 2019", "type": "Tinto", "region": "Alentejo", "price": 18.50, "description_pt": "Ícone do Alentejo, encorpado e complexo, com notas de fruta preta e especiarias.", "description_en": "An icon of Alentejo, full-bodied and complex, with notes of black fruit and spices." },
          { "id": 6, "name": "Papa Figos Branco 2022", "type": "Branco", "region": "Douro", "price": 6.99, "description_pt": "Perfil fresco e floral, excelente parceiro para peixe grelhado.", "description_en": "A fresh and floral profile, an excellent partner for grilled fish." },
          { "id": 7, "name": "Muralhas de Monção Vinho Verde", "type": "Branco", "region": "Vinho Verde", "price": 4.99, "description_pt": "Leve, fresco e com uma ligeira gaseificação. Perfeito para um dia quente.", "description_en": "Light, fresh, and with a slight fizz. Perfect for a hot day." },
          { "id": 8, "name": "Herdade do Esporão Reserva Tinto 2020", "type": "Tinto", "region": "Alentejo", "price": 22.00, "description_pt": "Encorpado, elegante e com grande potencial de envelhecimento.", "description_en": "Full-bodied, elegant, and with great aging potential." },
          { "id": 9, "name": "Vertente Rosé 2022", "type": "Rosé", "region": "Douro", "price": 11.50, "description_pt": "Perfil gastronómico. Acompanha bem pratos de sushi ou salmão.", "description_en": "Gastronomic profile. Pairs well with sushi or salmon dishes." },
          { "id": 10, "name": "Murganheira Reserva Bruto", "type": "Espumante", "region": "Távora-Varosa", "price": 15.20, "description_pt": "Premium, complexo e elegante, com notas de brioche e fruta de polpa branca.", "description_en": "Premium, complex, and elegant, with notes of brioche and white pulp fruit." },
          { "id": 11, "name": "Grão Vasco Dão Tinto", "type": "Tinto", "region": "Dão", "price": 4.50, "description_pt": "Popular, conhecido pela sua suavidade e versatilidade à mesa.", "description_en": "Popular, known for its smoothness and versatility at the table." },
          { "id": 12, "name": "Monte Velho Branco", "type": "Branco", "region": "Alentejo", "price": 5.00, "description_pt": "Fiável, frutado e fresco. Excelente relação qualidade/preço.", "description_en": "Reliable, fruity and fresh. Excellent value for money." },
          { "id": 13, "name": "Quinta do Crasto Reserva Vinhas Velhas 2019", "type": "Tinto", "region": "Douro", "price": 45.00, "description_pt": "Tinto de topo, complexo, concentrado e com um final longo. Para ocasiões especiais.", "description_en": "A top red, complex, concentrated, and with a long finish. For special occasions." },
          { "id": 14, "name": "Soalheiro Alvarinho", "type": "Branco", "region": "Vinho Verde", "price": 14.00, "description_pt": "Um dos melhores Alvarinhos, intenso, tropical e com uma mineralidade distinta.", "description_en": "One of the best Alvarinhos, intense, tropical, and with a distinct minerality." },
          { "id": 15, "name": "Filipa Pato 3B Rosé Bruto", "type": "Espumante", "region": "Bairrada", "price": 13.00, "description_pt": "Informal e delicioso, cheio de notas de framboesa e morango.", "description_en": "Informal and delicious, full of raspberry and strawberry notes." },
          { "id": 16, "name": "Meandro do Vale Meão Tinto", "type": "Tinto", "region": "Douro", "price": 16.00, "description_pt": "O segundo vinho da famosa Quinta do Vale Meão, qualidade fantástica para o preço.", "description_en": "The second wine of the famous Quinta do Vale Meão, fantastic quality for its price." },
          { "id": 17, "name": "Redoma Branco", "type": "Branco", "region": "Douro", "price": 25.00, "description_pt": "Branco de grande complexidade, fermentado em barrica, com notas minerais e citrinas.", "description_en": "White of great complexity, barrel-fermented, with mineral and citrus notes." },
          { "id": 18, "name": "Periquita Original", "type": "Tinto", "region": "Península de Setúbal", "price": 5.50, "description_pt": "O primeiro tinto engarrafado em Portugal, um clássico acessível e gastronómico.", "description_en": "The first red wine bottled in Portugal, an accessible and gastronomic classic." },
          { "id": 19, "name": "Aveleda Loureiro", "type": "Branco", "region": "Vinho Verde", "price": 6.00, "description_pt": "Monovarietal de Loureiro, muito aromático com notas florais e citrinas.", "description_en": "Single-varietal Loureiro, very aromatic with floral and citrus notes." },
          { "id": 20, "name": "Vértice Cuvée Bruto", "type": "Espumante", "region": "Douro", "price": 19.00, "description_pt": "Espumante de topo do Douro de altitude, resultando num vinho muito fresco e elegante.", "description_en": "Top sparkling wine from high-altitude Douro, resulting in a very fresh and elegant wine." },
          { "id": 21, "name": "Trinca Bolotas Tinto", "type": "Tinto", "region": "Alentejo", "price": 7.00, "description_pt": "Alentejano jovem e frutado, com um perfil moderno e fácil de agradar.", "description_en": "A young and fruity Alentejo wine, with a modern and easy-to-please profile." },
          { "id": 22, "name": "Paço dos Cunhas de Santar Vinha do Contador", "type": "Tinto", "region": "Dão", "price": 35.00, "description_pt": "Um dos grandes vinhos do Dão, mostra a elegância e complexidade da região.", "description_en": "One of the great wines of Dão, it shows the elegance and complexity of the region." },
          { "id": 23, "name": "Quinta de La Rosa Rosé", "type": "Rosé", "region": "Douro", "price": 9.00, "description_pt": "Rosé de cor pálida e muito fresco, com notas de frutos vermelhos e um final mineral.", "description_en": "A pale-colored and very fresh rosé, with notes of red fruits and a mineral finish." },
          { "id": 24, "name": "Luis Pato Vinhas Velhas Branco", "type": "Branco", "region": "Bairrada", "price": 17.00, "description_pt": "Branco da Bairrada com grande capacidade de envelhecimento, cremoso e complexo.", "description_en": "A white from Bairrada with great aging potential, creamy and complex." },
          { "id": 25, "name": "Catarina Branco", "type": "Branco", "region": "Península de Setúbal", "price": 5.80, "description_pt": "Notas exóticas e tropicais, graças à casta Chardonnay.", "description_en": "Exotic and tropical notes, thanks to the Chardonnay grape." },
          { "id": 26, "name": "Poeira Tinto", "type": "Tinto", "region": "Douro", "price": 55.00, "description_pt": "Vinho de garagem icónico do Douro, elegante, complexo e com enorme potencial de guarda.", "description_en": "Iconic garage wine from Douro, elegant, complex and with huge aging potential." },
          { "id": 27, "name": "Anselmo Mendes Contacto Alvarinho", "type": "Branco", "region": "Vinho Verde", "price": 13.50, "description_pt": "Um Alvarinho com curtimenta, resultando num vinho com mais estrutura e complexidade.", "description_en": "An Alvarinho with skin contact, resulting in a wine with more structure and complexity." },
          { "id": 28, "name": "Sidónio de Sousa Garrafeira Tinto", "type": "Tinto", "region": "Bairrada", "price": 20.00, "description_pt": "Um Bairrada clássico da casta Baga, austero na juventude mas que envelhece com mestria.", "description_en": "A classic Bairrada from the Baga grape, austere in youth but ages masterfully." },
          { "id": 29, "name": "Herdade do Rocim Amphora Tinto", "type": "Tinto", "region": "Alentejo", "price": 18.00, "description_pt": "Vinho feito em ânforas de barro segundo métodos ancestrais. Puro e autêntico.", "description_en": "Wine made in clay amphorae according to ancient methods. Pure and authentic." },
          { "id": 30, "name": "Quinta dos Roques Encruzado", "type": "Branco", "region": "Dão", "price": 15.00, "description_pt": "Referência da casta Encruzado no Dão. Complexo, mineral e com excelente capacidade de evolução.", "description_en": "A benchmark for the Encruzado grape in Dão. Complex, mineral and with excellent evolution capacity." },
          { "id": 31, "name": "Niepoort Redoma Rosé", "type": "Rosé", "region": "Douro", "price": 16.50, "description_pt": "Um rosé sério e gastronómico, fermentado em barrica, com grande complexidade.", "description_en": "A serious and gastronomic rosé, barrel-fermented, with great complexity." },
          { "id": 32, "name": "Vale da Capucha Arinto", "type": "Branco", "region": "Lisboa", "price": 12.00, "description_pt": "Branco da região de Lisboa com forte influência atlântica. Salino, mineral e muito fresco.", "description_en": "White from the Lisbon region with a strong Atlantic influence. Saline, mineral and very fresh." },
          { "id": 33, "name": "Quinta do Montalto Cepa Pura", "type": "Tinto", "region": "Tejo", "price": 9.00, "description_pt": "Tinto biológico da região do Tejo, focado na fruta e na pureza, sem madeira.", "description_en": "Organic red from the Tejo region, focused on fruit and purity, without wood." },
          { "id": 34, "name": "Kompassus Blanc de Noirs", "type": "Espumante", "region": "Bairrada", "price": 24.00, "description_pt": "Espumante 'branco de tintas', feito da casta Baga. Incomum, estruturado e fascinante.", "description_en": "A 'white from reds' sparkling wine, made from the Baga grape. Unusual, structured and fascinating." },
          { "id": 35, "name": "AdegaMãe Dory Branco", "type": "Branco", "region": "Lisboa", "price": 7.50, "description_pt": "Um best-seller de Lisboa, com perfil atlântico, fresco e muito versátil com comida.", "description_en": "A bestseller from Lisbon, with an Atlantic profile, fresh and very versatile with food." },
          { "id": 36, "name": "Julia Kemper Curiosity Tinto", "type": "Tinto", "region": "Dão", "price": 11.00, "description_pt": "Um Dão moderno e apelativo, com fruta vibrante e taninos suaves.", "description_en": "A modern and appealing Dão, with vibrant fruit and soft tannins." },
          { "id": 37, "name": "Márcio Lopes Pequenos Rebentos Alvarinho", "type": "Branco", "region": "Vinho Verde", "price": 10.00, "description_pt": "Alvarinho de Monção e Melgaço de um produtor da nova geração, focado na pureza.", "description_en": "Alvarinho from Monção and Melgaço from a new generation producer, focused on purity." },
          { "id": 38, "name": "Fitapreta a Laranja Mecânica", "type": "Branco", "region": "Alentejo", "price": 28.00, "description_pt": "Um 'vinho laranja', branco vinificado como tinto, com cor, taninos e aromas únicos.", "description_en": "An 'orange wine', white vinified as a red, with unique color, tannins, and aromas." },
          { "id": 39, "name": "Vadio Tinto", "type": "Tinto", "region": "Bairrada", "price": 10.50, "description_pt": "Uma excelente introdução à casta Baga da Bairrada, por um produtor de referência.", "description_en": "An excellent introduction to the Baga grape from Bairrada, by a benchmark producer." },
          { "id": 40, "name": "Quinta de Chocapalha Arinto", "type": "Branco", "region": "Lisboa", "price": 9.50, "description_pt": "Um Arinto de Lisboa vibrante, cheio de acidez e notas de lima. Muito gastronómico.", "description_en": "A vibrant Arinto from Lisbon, full of acidity and lime notes. Very gastronomic." },
          { "id": 41, "name": "Covela Edição Nacional Avesso", "type": "Branco", "region": "Vinho Verde", "price": 8.00, "description_pt": "Focado na casta Avesso, é um Vinho Verde com mais corpo e potencial de guarda.", "description_en": "Focused on the Avesso grape, it is a Vinho Verde with more body and aging potential." },
          { "id": 42, "name": "Churchill's Estates Tinto", "type": "Tinto", "region": "Douro", "price": 9.80, "description_pt": "Um Douro com excelente relação preço-qualidade, focado na elegância e fruta.", "description_en": "A Douro wine with an excellent price-quality ratio, focused on elegance and fruit." },
          { "id": 43, "name": "Aphros Phaunus Pet Nat", "type": "Espumante", "region": "Vinho Verde", "price": 19.00, "description_pt": "Um espumante natural (Pet Nat) biodinâmico, turvo, super fresco e irreverente.", "description_en": "A biodynamic natural sparkling wine (Pet Nat), cloudy, super fresh and irreverent." },
          { "id": 44, "name": "Casa de Mouraz Elfa Tinto", "type": "Tinto", "region": "Dão", "price": 8.50, "description_pt": "Tinto biodinâmico do Dão, com um perfil elegante, floral e muito puro.", "description_en": "Biodynamic red from Dão, with an elegant, floral, and very pure profile." },
          { "id": 45, "name": "Vicente Faria Animus", "type": "Tinto", "region": "Douro", "price": 4.00, "description_pt": "Um dos vinhos mais vendidos em Portugal, prova que bom e barato é possível.", "description_en": "One of the best-selling wines in Portugal, proving that good and cheap is possible." },
          { "id": 46, "name": "Folias de Baco Uivo Renegado", "type": "Tinto", "region": "Douro", "price": 14.00, "description_pt": "Um tinto de vinhas velhas com múltiplas castas, resultando num vinho leve e 'selvagem'.", "description_en": "A red from old vines with multiple grape varieties, resulting in a light and 'wild' wine." },
          { "id": 47, "name": "Quinta do Ameal Loureiro", "type": "Branco", "region": "Vinho Verde", "price": 12.50, "description_pt": "Um Loureiro de referência, mostra o potencial aromático e a longevidade da casta.", "description_en": "A benchmark Loureiro, shows the aromatic potential and longevity of the grape." },
          { "id": 48, "name": "Quinta das Bágeiras Garrafeira Tinto", "type": "Tinto", "region": "Bairrada", "price": 29.00, "description_pt": "Um Bairrada à antiga, 100% Baga, que precisa de anos em garrafa para se revelar.", "description_en": "An old-school Bairrada, 100% Baga, that needs years in the bottle to reveal itself." },
          { "id": 49, "name": "Mouchão Tinto", "type": "Tinto", "region": "Alentejo", "price": 38.00, "description_pt": "Vinho icónico do Alentejo, feito em lagares e com Alicante Bouschet. Potente e longevo.", "description_en": "Iconic wine from Alentejo, made in traditional lagares with Alicante Bouschet. Powerful and long-lived." },
          { "id": 50, "name": "Soalheiro Granit", "type": "Branco", "region": "Vinho Verde", "price": 16.00, "description_pt": "Uma faceta diferente do Alvarinho, mais mineral e austera, vinda de solos de granito.", "description_en": "A different side of Alvarinho, more mineral and austere, from granite soils." },
          // Rest of the 350 wines
          ...Array.from({ length: 300 }, (_, i) => {
              const baseId = 51;
              const wineType = ["Tinto", "Branco", "Rosé", "Espumante"][i % 4];
              const region = ["Douro", "Alentejo", "Dão", "Vinho Verde", "Lisboa", "Bairrada", "Tejo", "Trás-os-Montes", "Beira Interior", "Açores"][i % 10];
              
              return {
                  "id": baseId + i,
                  "name": `Vinho Descoberta Nº${i + 1}`,
                  "type": wineType,
                  "region": region,
                  "price": 8.00 + (i * 0.25),
                  "description_pt": `Um vinho único para explorar, da região de ${region}. Ideal para quem procura novas experiências.`,
                  "description_en": `A unique wine to explore, from the ${region} region. Ideal for those seeking new experiences.`
              }
          })
        ];

        // --- Traduções ---
        const translations = {
            pt: {
                home_welcome: "Beba vinhos, não rótulos.",
                home_subtitle: "O seu assistente para descobrir o melhor de Portugal.",
                menu_recommend_title: "Recomendar Vinho",
                menu_recommend_desc: "Encontre o vinho perfeito com base nas suas preferências.",
                menu_dish_title: "Vinho para um Prato",
                menu_dish_desc: "Diga-nos o que vai cozinhar e nós sugerimos o vinho.",
                menu_gift_title: "Oferecer um Vinho",
                menu_gift_desc: "Encontre a prenda ideal para qualquer ocasião.",
                menu_curiosity_title: "Curiosidades",
                menu_curiosity_desc: "Pergunte algo sobre vinhos ou veja a curiosidade do dia.",
                recommender_occasion_label: "Qual a ocasião?",
                recommender_type_label: "Que tipo de vinho prefere?",
                recommender_budget_label: "Qual o seu orçamento?",
                dish_label: "O que vai cozinhar?",
                dish_placeholder: "Ex: Bacalhau com natas, bife da vazia grelhado...",
                gift_label: "Descreva a pessoa e a ocasião:",
                gift_placeholder: "Ex: É para o aniversário do meu pai, que adora tintos encorpados do Douro...",
                curiosity_label: "Qual a sua dúvida sobre vinhos?",
                curiosity_placeholder: "Ex: Qual a diferença entre Touriga Nacional e Tinta Roriz?",
                btn_search: "Pesquisar",
                btn_suggest_wine: "Sugerir Vinho",
                btn_suggest_gift: "Sugerir Oferta",
                btn_ask: "Perguntar",
                btn_curiosity_day: "Curiosidade do Dia",
                btn_homepage: "Voltar ao Início",
                btn_other_suggestion: "Outra Sugestão",
                result_title: "A nossa sugestão para si:",
                pairing_suggestion_title: "Sugestão de harmonização:",
                gift_suggestion_title: "A prenda ideal:",
                curiosity_answer_title: "Resposta:",
                curiosity_day_title: "Curiosidade do Dia:",
                error_no_wine: "Não foi possível encontrar um vinho com esses critérios. Tente novamente.",
                error_generic: "Ocorreu um erro. Por favor, tente mais tarde.",
                loading: "A pensar...",
                occasion_options: ["Qualquer Ocasião", "Jantar especial", "Refeição do dia-a-dia", "Comemoração", "Acompanhar carnes", "Acompanhar peixe e marisco"],
                wine_types: ["Qualquer Tipo", "Branco", "Rosé", "Tinto", "Espumante"],
                budget_options: ["Até 10€", "Entre 10€ e 20€", "Mais de 20€"]
            },
            en: {
                home_welcome: "Drink wines, not labels.",
                home_subtitle: "Your assistant for discovering the best of Portugal.",
                menu_recommend_title: "Recommend Wine",
                menu_recommend_desc: "Find the perfect wine based on your preferences.",
                menu_dish_title: "Wine for a Dish",
                menu_dish_desc: "Tell us what you're cooking and we'll suggest a wine.",
                menu_gift_title: "Gift a Wine",
                menu_gift_desc: "Find the ideal gift for any occasion.",
                menu_curiosity_title: "Curiosities",
                menu_curiosity_desc: "Ask something about wine or see the curiosity of the day.",
                recommender_occasion_label: "What's the occasion?",
                recommender_type_label: "What type of wine do you prefer?",
                recommender_budget_label: "What's your budget?",
                dish_label: "What are you cooking?",
                dish_placeholder: "E.g., Codfish with cream, grilled sirloin steak...",
                gift_label: "Describe the person and the occasion:",
                gift_placeholder: "E.g., It's for my father's birthday, he loves full-bodied reds from Douro...",
                curiosity_label: "What is your wine question?",
                curiosity_placeholder: "E.g., What's the difference between Touriga Nacional and Tinta Roriz?",
                btn_search: "Search",
                btn_suggest_wine: "Suggest Wine",
                btn_suggest_gift: "Suggest Gift",
                btn_ask: "Ask",
                btn_curiosity_day: "Curiosity of the Day",
                btn_homepage: "Back to Home",
                btn_other_suggestion: "Another Suggestion",
                result_title: "Our suggestion for you:",
                pairing_suggestion_title: "Pairing suggestion:",
                gift_suggestion_title: "The ideal gift:",
                curiosity_answer_title: "Answer:",
                curiosity_day_title: "Curiosity of the Day:",
                error_no_wine: "Could not find a wine with these criteria. Please try again.",
                error_generic: "An error occurred. Please try again later.",
                loading: "Thinking...",
                occasion_options: ["Any Occasion", "Special dinner", "Everyday meal", "Celebration", "Pair with meats", "Pair with fish and seafood"],
                wine_types: ["Any Type", "White", "Rosé", "Red", "Sparkling"],
                budget_options: ["Up to €10", "Between €10 and €20", "More than €20"]
            }
        };

        // --- Funções Principais ---

        function init() {
            try {
                wines = wineDatabase;
                if(!wines || wines.length === 0) {
                    throw new Error('Wine data is empty or missing.');
                }
            } catch (error) {
                console.error('Failed to load wine database:', error);
                alert('Error loading wine data. Please refresh the page.');
            }
            updateLanguage(currentLang);
            setupEventListeners();
        }

        function updateLanguage(lang) {
            currentLang = lang;
            langToggle.textContent = lang.toUpperCase();
            allLangElements.forEach(el => {
                const key = el.dataset.langKey;
                if (translations[lang][key]) {
                    if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
                        el.placeholder = translations[lang][key];
                    } else {
                        el.textContent = translations[lang][key];
                    }
                }
            });
            populateSelects(lang);
        }

        function populateSelects(lang) {
            const occasionSelect = document.getElementById('recommender-occasion');
            occasionSelect.innerHTML = translations[lang].occasion_options.map(t => `<option value="${t}">${t}</option>`).join('');

            const wineTypeSelect = document.getElementById('recommender-type');
            wineTypeSelect.innerHTML = translations[lang].wine_types.map(t => `<option value="${t}">${t}</option>`).join('');

            const budgetSelect = document.getElementById('recommender-budget');
            budgetSelect.innerHTML = translations[lang].budget_options.map(b => `<option value="${b}">${b}</option>`).join('');
        }

        function showView(viewId) {
            views.forEach(view => view.classList.remove('active'));
            const viewToShow = document.getElementById(viewId);
            if(viewToShow) viewToShow.classList.add('active');
        }

        function setupEventListeners() {
            langToggle.addEventListener('click', () => updateLanguage(currentLang === 'pt' ? 'en' : 'pt'));
            
            menuButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const viewId = button.dataset.view;
                    showView(viewId);
                    // Limpar resultados anteriores ao entrar numa nova vista
                    document.getElementById(viewId.replace('-view', '-result')).innerHTML = '';
                });
            });

            document.querySelectorAll('.home-btn').forEach(btn => {
                btn.addEventListener('click', () => showView('home-view'));
            });

            document.getElementById('recommender-btn').addEventListener('click', () => handleRecommenderSubmit(false));
            document.getElementById('dish-btn').addEventListener('click', () => handleDishSubmit(false));
            document.getElementById('gift-btn').addEventListener('click', () => handleGiftSubmit(false));
            document.getElementById('curiosity-ask-btn').addEventListener('click', handleCuriosityAsk);
            document.getElementById('curiosity-day-btn').addEventListener('click', handleCuriosityDay);
        }

        async function callGeminiAPI(prompt, expectJson = false) {
            const apiKey = "AIzaSyD04DMA12LJ6GWVxeWlFRgQ-pWjHKYz7es"; 
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            const payload = { contents: [{ parts: [{ text: prompt }] }] };

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if (response.status === 401) {
                    throw new Error("Erro de Autenticação (401). A chave da API parece estar em falta ou é inválida. Se estiver a executar a aplicação localmente, certifique-se de que a variável 'apiKey' contém a sua chave.");
                }
                if (!response.ok) throw new Error(`Erro na API: ${response.status} ${response.statusText}`);
                
                const result = await response.json();
                const text = result.candidates?.[0]?.content?.parts?.[0]?.text;
                if (!text) throw new Error("No content in API response.");

                if (expectJson) {
                    const jsonMatch = text.match(/\{[\s\S]*\}/);
                    if (jsonMatch) return JSON.parse(jsonMatch[0]);
                    throw new Error("Expected JSON, but not found.");
                }
                return text;
            } catch (error) {
                console.error("Gemini API call failed:", error);
                throw error;
            }
        }

        function renderLoading(container) {
            const loadingHTML = `
                <div class="flex flex-col items-center justify-center p-8 text-center">
                    <div class="loading-spinner"></div>
                    <p class="mt-4 text-gray-600 font-semibold" data-lang-key="loading">${translations[currentLang].loading}</p>
                </div>
            `;
            container.innerHTML = loadingHTML;
        }

        function renderWineResult(wine, container, titleKey, showAnotherSuggestion = true, retryCallback = null) {
            if (!wine) {
                 const errorHTML = `<p class="text-center text-red-600">${translations[currentLang].error_no_wine}</p>`;
                 container.innerHTML = errorHTML;
                 return;
            }
            const description = currentLang === 'pt' ? wine.description_pt : wine.description_en;

            const resultHTML = `
                <div class="border rounded-lg overflow-hidden border-t-4 border-[--brand-red]">
                    <h3 class="p-4 text-lg font-bold bg-gray-50">${translations[currentLang][titleKey]}</h3>
                    <div class="p-4">
                        <h4 class="text-xl font-bold title-font">${wine.name}</h4>
                        <p class="text-md font-semibold text-gray-700">${wine.region} - ${wine.price.toFixed(2)}€</p>
                        <p class="mt-2 text-sm text-gray-600">${description}</p>
                    </div>
                    ${showAnotherSuggestion && retryCallback ? `
                    <div class="p-4 bg-gray-50">
                        <button class="btn-primary w-full py-2 rounded-md other-suggestion-btn">
                            ${translations[currentLang].btn_other_suggestion}
                        </button>
                    </div>` : ''}
                </div>
            `;
            container.innerHTML = resultHTML;
            if (showAnotherSuggestion && retryCallback) {
                 container.querySelector('.other-suggestion-btn')?.addEventListener('click', retryCallback);
            }
        }
        
        function renderTextResult(text, container, titleKey) {
            container.innerHTML = `
                <div class="border rounded-lg p-4 bg-white border-t-4 border-[--brand-red]">
                     <h3 class="text-lg font-bold mb-2">${translations[currentLang][titleKey]}</h3>
                     <p class="text-gray-700 whitespace-pre-wrap">${text}</p>
                </div>
            `;
        }

        function toggleLoading(button, isLoading, otherButton = null) {
            const buttons = [button, otherButton].filter(Boolean);

            buttons.forEach(btn => {
                const textSpan = btn.querySelector('span');
                const originalTextKey = btn.dataset.langKey;
                
                btn.disabled = isLoading;

                if (isLoading) {
                    if(textSpan) textSpan.textContent = translations[currentLang].loading;
                } else {
                    if(textSpan && originalTextKey) textSpan.textContent = translations[currentLang][originalTextKey];
                }
            });
        }
        
        // --- Handlers de Submissão ---

        async function handleRecommenderSubmit(isRetry = false) {
            const btn = document.getElementById('recommender-btn');
            const resultContainer = document.getElementById('recommender-result');
            
            if(!isRetry) {
                lastSuggestionContext.excludedIds = []; // Reset on new search
            }

            toggleLoading(btn, true);
            renderLoading(resultContainer);
            
            const occasion = document.getElementById('recommender-occasion').value;
            const type = document.getElementById('recommender-type').value;
            const budget = document.getElementById('recommender-budget').value;

            let filtered = wines.filter(wine => {
                const anyTypeOption = translations[currentLang].wine_types[0];
                let typeMatch = false;
                if (type === anyTypeOption) {
                    typeMatch = true;
                } else {
                    let translatedWineType = wine.type;
                    if (currentLang === 'en') {
                        switch(wine.type) {
                            case 'Tinto': translatedWineType = 'Red'; break;
                            case 'Branco': translatedWineType = 'White'; break;
                            case 'Espumante': translatedWineType = 'Sparkling'; break;
                        }
                    }
                    typeMatch = (translatedWineType === type);
                }
                
                let budgetMatch = false;
                if(budget === translations[currentLang].budget_options[0] && wine.price <= 10) budgetMatch = true;
                if(budget === translations[currentLang].budget_options[1] && wine.price > 10 && wine.price <= 20) budgetMatch = true;
                if(budget === translations[currentLang].budget_options[2] && wine.price > 20) budgetMatch = true;
                
                const notExcluded = !lastSuggestionContext.excludedIds.includes(wine.id);

                return typeMatch && budgetMatch && notExcluded;
            });

            if (filtered.length === 0) {
                renderWineResult(null, resultContainer, '');
                toggleLoading(btn, false);
                return;
            }

            const prompt = `From the following JSON list of wines, select the single best wine for this occasion: "${occasion}". Exclude wines with these IDs: ${lastSuggestionContext.excludedIds.join(',')}. Your response MUST be a JSON object with this structure: {"selected_wine_id": ID_NUMBER}. The JSON list is: ${JSON.stringify(filtered)}`;
            
            try {
                await new Promise(resolve => setTimeout(resolve, 500));
                const result = await callGeminiAPI(prompt, true);
                const suggestedWine = wines.find(w => w.id === result.selected_wine_id);
                if (suggestedWine) {
                    lastSuggestionContext.excludedIds.push(suggestedWine.id);
                    renderWineResult(suggestedWine, resultContainer, 'result_title', true, () => handleRecommenderSubmit(true));
                } else {
                    throw new Error("API returned an invalid wine ID.");
                }
            } catch (error) {
                renderTextResult(error.message, resultContainer, 'error_generic');
            } finally {
                toggleLoading(btn, false);
            }
        }

        async function handleDishSubmit(isRetry = false) {
             const btn = document.getElementById('dish-btn');
             const resultContainer = document.getElementById('dish-result');
             const dish = document.getElementById('dish-input').value;

             if(!isRetry) {
                lastSuggestionContext.excludedIds = [];
             }
             
             toggleLoading(btn, true);
             renderLoading(resultContainer);

             const availableWines = wines.filter(w => !lastSuggestionContext.excludedIds.includes(w.id));
             if (availableWines.length === 0) {
                 renderWineResult(null, resultContainer, '');
                 toggleLoading(btn, false);
                 return;
             }

             const prompt = `From the following JSON list of wines, select the single best wine to pair with this dish: "${dish}". Your response MUST be a JSON object with this structure: {"selected_wine_id": ID_NUMBER}. The JSON list is: ${JSON.stringify(availableWines)}`;

             try {
                await new Promise(resolve => setTimeout(resolve, 500));
                const result = await callGeminiAPI(prompt, true);
                const suggestedWine = wines.find(w => w.id === result.selected_wine_id);
                if (suggestedWine) {
                    lastSuggestionContext.excludedIds.push(suggestedWine.id);
                    renderWineResult(suggestedWine, resultContainer, 'pairing_suggestion_title', true, () => handleDishSubmit(true));
                } else {
                     throw new Error("API returned an invalid wine ID.");
                }
            } catch (error) {
                renderTextResult(error.message, resultContainer, 'error_generic');
            } finally {
                toggleLoading(btn, false);
            }
        }

        async function handleGiftSubmit(isRetry = false) {
             const btn = document.getElementById('gift-btn');
             const resultContainer = document.getElementById('gift-result');
             const description = document.getElementById('gift-input').value;

             if(!isRetry) {
                lastSuggestionContext.excludedIds = [];
             }
             
             toggleLoading(btn, true);
             renderLoading(resultContainer);
             
             const availableWines = wines.filter(w => !lastSuggestionContext.excludedIds.includes(w.id));
             if (availableWines.length === 0) {
                 renderWineResult(null, resultContainer, '');
                 toggleLoading(btn, false);
                 return;
             }

             const prompt = `From the following JSON list of wines, select the single best wine to gift based on this description: "${description}". Your response MUST be a JSON object with this structure: {"selected_wine_id": ID_NUMBER}. The JSON list is: ${JSON.stringify(availableWines)}`;

             try {
                await new Promise(resolve => setTimeout(resolve, 500));
                const result = await callGeminiAPI(prompt, true);
                const suggestedWine = wines.find(w => w.id === result.selected_wine_id);
                if(suggestedWine) {
                    lastSuggestionContext.excludedIds.push(suggestedWine.id);
                    renderWineResult(suggestedWine, resultContainer, 'gift_suggestion_title', true, () => handleGiftSubmit(true));
                } else {
                     throw new Error("API returned an invalid wine ID.");
                }
            } catch (error) {
                renderTextResult(error.message, resultContainer, 'error_generic');
            } finally {
                toggleLoading(btn, false);
            }
        }

        async function handleCuriosityAsk() {
            const askBtn = document.getElementById('curiosity-ask-btn');
            const dayBtn = document.getElementById('curiosity-day-btn');
            const resultContainer = document.getElementById('curiosities-result');
            const question = document.getElementById('curiosity-input').value;

            toggleLoading(askBtn, true, dayBtn);
            renderLoading(resultContainer);
            
            const prompt = `You are a friendly and knowledgeable sommelier. Answer the following wine-related question clearly and concisely in ${currentLang === 'pt' ? 'Portuguese' : 'English'}. The answer should be informative and easy to understand. Question: "${question}"`;
            
            try {
                await new Promise(resolve => setTimeout(resolve, 500));
                const answer = await callGeminiAPI(prompt, false);
                renderTextResult(answer, resultContainer, 'curiosity_answer_title');
            } catch (error) {
                renderTextResult(error.message, resultContainer, 'error_generic');
            } finally {
                toggleLoading(askBtn, false, dayBtn);
            }
        }

        async function handleCuriosityDay() {
            const dayBtn = document.getElementById('curiosity-day-btn');
            const askBtn = document.getElementById('curiosity-ask-btn');
            const resultContainer = document.getElementById('curiosities-result');
            
            toggleLoading(dayBtn, true, askBtn);
            renderLoading(resultContainer);

            const prompt = `You are a passionate sommelier. Generate a short, interesting, and fun "Wine Fact of the Day". It can be about a grape variety, a region, a winemaking technique, or a historical curiosity. The response must be in ${currentLang === 'pt' ? 'Portuguese' : 'English'}.`;

            try {
                await new Promise(resolve => setTimeout(resolve, 500));
                const fact = await callGeminiAPI(prompt, false);
                renderTextResult(fact, resultContainer, 'curiosity_day_title');
            } catch (error) {
                renderTextResult(error.message, resultContainer, 'error_generic');
            } finally {
                toggleLoading(dayBtn, false, askBtn);
            }
        }


        // --- Inicialização ---
        init();
    });
</script>

</body>
</html>


